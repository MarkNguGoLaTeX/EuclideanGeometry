%  ========== PREAMBLE ==========


% -= Packages =-

\usepackage[utf8]{vietnam}
\usepackage[top=1in,bottom=1in,left=1in,right=1in,paper=a4paper]{geometry}
\usepackage{graphicx,float}
\usepackage{hyperref}
\usepackage[most]{tcolorbox}
\usepackage{amsmath,amsfonts,amssymb,amsthm,mathtools,gensymb}
\usepackage{hyperref}
\usepackage{tikz}
\usepackage{titling}
\usepackage{lipsum}
\usepackage{mathtools}
\usepackage{enumitem}
\usepackage[utf8]{inputenc}
\usepackage[titletoc,title]{appendix}
\usepackage{xcolor}
\usepackage{fancyhdr}
\usepackage[parfill]{parskip}
\usepackage{multicol}
\usepackage{sectsty}
\usepackage{pgfplots}
\pgfplotsset{compat=1.15}
\usepackage{mathrsfs}
\usetikzlibrary{arrows}
\usepackage{fontawesome5}
\usepackage{titlesec}
\usepackage{tocloft}

\usetikzlibrary{arrows.meta, decorations.pathreplacing,calc}


% -= Environments =-


\newtheorem{exercise}{Bài}
% \newtheorem*{solution}{Lời giải}


% -= Settings =-

\pagestyle{fancy}
\allsectionsfont{\bfseries\sffamily}

\graphicspath{ {./images/} }

\hypersetup{
    colorlinks,
    citecolor=black,
    filecolor=black,
    linkcolor=purple,
    urlcolor=blue
}


\renewcommand{\baselinestretch}{1.5}
\newcommand{\qedblack}{$\hfill\blacksquare$}

\newcommand{\divides}{\mid}
\newcommand{\notdivides}{\nmid}

\DeclareMathOperator{\ord}{ord}

\DeclarePairedDelimiter\abs{\lvert}{\rvert}%
\DeclarePairedDelimiter\norm{\lVert}{\rVert}%

\renewcommand{\footrulewidth}{0.45pt}
\renewcommand{\headrulewidth}{0.45pt}
\definecolor{mahgreen}{HTML}{133f00}
\definecolor{mahred}{HTML}{5b0000}
\definecolor{mahnvy}{HTML}{254a6d}
\definecolor{mahprp}{HTML}{3b1344}
\definecolor{mahorg}{HTML}{893101}
\definecolor{mahtqs}{HTML}{5f8998}
\definecolor{mahblue}{HTML}{201f41}
\definecolor{bbe}{HTML}{000000}
\definecolor{headerbg}{RGB}{0, 0, 0} 
\definecolor{headertext}{RGB}{255, 250, 240}
\setlength{\headheight}{21pt}


% -= Theorem Environments =-


\newtcolorbox[auto counter,number within=section,number format=\arabic]{definition}[1][]{
            colback=mahblue!10!white,enhanced,
            title={\textbf{\faBook\ \ Định nghĩa~\thetcbcounter}},
            attach boxed title to top left={xshift=-4mm},
            boxrule=0pt,
            after skip=1cm,before skip=1cm,right skip=0cm,
            breakable,fonttitle=\sffamily,
            toprule=0pt,bottomrule=0pt,rightrule=0pt,leftrule=4pt,
            arc=0mm,
            skin=enhancedlast jigsaw,
            sharp corners,
            colframe=mahblue,colbacktitle=mahblue!90!white,
            boxed title style={
                frame code={
                    \fill[mahblue!90!white](frame.south west)--(frame.north west)--(frame.north east)--([xshift=3mm]frame.east)--(frame.south east)--cycle;
                    \draw[line width=1mm,mahblue!90!white]([xshift=2mm]frame.north east)--([xshift=5mm]frame.east)--([xshift=2mm]frame.south east);
                    \draw[line width=1mm,mahblue!90!white]([xshift=5mm]frame.north east)--([xshift=8mm]frame.east)--([xshift=5mm]frame.south east);
                    \fill[mahblue!80!white](frame.south west)--+(4mm,-2mm)--+(4mm,2mm)--cycle;
                }
            }
}

\newtcolorbox[auto counter,number within=section,number format=\arabic]{theorem}[1][]{
            colback=mahred!10!white,enhanced,
            title={\textbf{\faPen\ \ Định lí~\thetcbcounter}},
            attach boxed title to top left={xshift=-4mm},
            boxrule=0pt,
            after skip=1cm,before skip=1cm,right skip=0cm,
            breakable,fonttitle=\sffamily,
            toprule=0pt,bottomrule=0pt,rightrule=0pt,leftrule=4pt,
            arc=0mm,
            skin=enhancedlast jigsaw,
            sharp corners,
            colframe=mahred,colbacktitle=mahred!90!white,
            boxed title style={
                frame code={
                    \fill[mahred!90!white](frame.south west)--(frame.north west)--(frame.north east)--([xshift=3mm]frame.east)--(frame.south east)--cycle;
                    \draw[line width=1mm,mahred!90!white]([xshift=2mm]frame.north east)--([xshift=5mm]frame.east)--([xshift=2mm]frame.south east);
                    \draw[line width=1mm,mahred!90!white]([xshift=5mm]frame.north east)--([xshift=8mm]frame.east)--([xshift=5mm]frame.south east);
                    \fill[mahred!80!white](frame.south west)--+(4mm,-2mm)--+(4mm,2mm)--cycle;
                }
            }
}

\newtcolorbox[auto counter,number within=section,number format=\arabic]{property}[1][]{
            colback=mahnvy!10!white,enhanced,
            title={\textbf{\faBookmark\ \ Tính chất~\thetcbcounter}},
            attach boxed title to top left={xshift=-4mm},
            boxrule=0pt,
            after skip=1cm,before skip=1cm,right skip=0cm,
            breakable,fonttitle=\sffamily,
            toprule=0pt,bottomrule=0pt,rightrule=0pt,leftrule=4pt,
            arc=0mm,
            skin=enhancedlast jigsaw,
            sharp corners,
            colframe=mahnvy,colbacktitle=mahnvy!90!white,
            boxed title style={
                frame code={
                    \fill[mahnvy!90!white](frame.south west)--(frame.north west)--(frame.north east)--([xshift=3mm]frame.east)--(frame.south east)--cycle;
                    \draw[line width=1mm,mahnvy!90!white]([xshift=2mm]frame.north east)--([xshift=5mm]frame.east)--([xshift=2mm]frame.south east);
                    \draw[line width=1mm,mahnvy!90!white]([xshift=5mm]frame.north east)--([xshift=8mm]frame.east)--([xshift=5mm]frame.south east);
                    \fill[mahnvy!80!white](frame.south west)--+(4mm,-2mm)--+(4mm,2mm)--cycle;
                }
            }
}

\newtcolorbox[auto counter,number format=\arabic]{problem}[1][]{
            colback=mahgreen!10!white,enhanced,
            title={\textbf{\faFile*\ \ Bài toán~\thetcbcounter}},
            attach boxed title to top left={xshift=-4mm},
            boxrule=0pt,
            after skip=1cm,before skip=1cm,right skip=0cm,
            breakable,fonttitle=\sffamily,
            toprule=0pt,bottomrule=0pt,rightrule=0pt,leftrule=4pt,
            arc=0mm,
            skin=enhancedlast jigsaw,
            sharp corners,
            colframe=mahgreen,colbacktitle=mahgreen!90!white,
            boxed title style={
                frame code={
                    \fill[mahgreen!90!white](frame.south west)--(frame.north west)--(frame.north east)--([xshift=3mm]frame.east)--(frame.south east)--cycle;
                    \draw[line width=1mm,mahgreen!90!white]([xshift=2mm]frame.north east)--([xshift=5mm]frame.east)--([xshift=2mm]frame.south east);
                    \draw[line width=1mm,mahgreen!90!white]([xshift=5mm]frame.north east)--([xshift=8mm]frame.east)--([xshift=5mm]frame.south east);
                    \fill[mahgreen!80!white](frame.south west)--+(4mm,-2mm)--+(4mm,2mm)--cycle;
                }
            }
}

\newtcolorbox[auto counter,number within=section,number format=\arabic]{exproblem}[1][]{
            colback=mahgreen!10!white,enhanced,
            title={\textbf{\faFile*\ \ Ví dụ~\thetcbcounter}},
            attach boxed title to top left={xshift=-4mm},
            boxrule=0pt,
            after skip=1cm,before skip=1cm,right skip=0cm,
            breakable,fonttitle=\sffamily,
            toprule=0pt,bottomrule=0pt,rightrule=0pt,leftrule=4pt,
            arc=0mm,
            skin=enhancedlast jigsaw,
            sharp corners,
            colframe=mahgreen,colbacktitle=mahgreen!90!white,
            boxed title style={
                frame code={
                    \fill[mahgreen!90!white](frame.south west)--(frame.north west)--(frame.north east)--([xshift=3mm]frame.east)--(frame.south east)--cycle;
                    \draw[line width=1mm,mahgreen!90!white]([xshift=2mm]frame.north east)--([xshift=5mm]frame.east)--([xshift=2mm]frame.south east);
                    \draw[line width=1mm,mahgreen!90!white]([xshift=5mm]frame.north east)--([xshift=8mm]frame.east)--([xshift=5mm]frame.south east);
                    \fill[mahgreen!80!white](frame.south west)--+(4mm,-2mm)--+(4mm,2mm)--cycle;
                }
            }
}

\newtcolorbox[auto counter,number within=section,number format=\arabic]{corollary}[1][]{
            colback=mahprp!10!white,enhanced,
            title={\textbf{\faHandPointRight[regular] \ \ Hệ quả \thetcbcounter}},
            boxrule=0pt,
	    frame hidden,
            breakable,fonttitle=\sffamily,
            arc=0mm,
            sharp corners,
            detach title,
            before upper = \tcbtitle\par\smallskip,
            colframe=mahprp,coltitle=mahprp!85!black,
            borderline west = {1mm}{0pt}{mahprp!85!black},
            segmentation style={solid, mahprp!85!black}
}

\newtcolorbox[auto counter,number within=section,number format=\arabic]{lemma}[1][]{
            colback=mahorg!10!white,enhanced,
            title={\textbf{\faBook \ \ Bổ đề}},
            boxrule=0pt,
	    frame hidden,
            breakable,fonttitle=\sffamily,
            arc=0mm,
            sharp corners,
            detach title,
            before upper = \tcbtitle\par\smallskip,
            colframe=mahorg,coltitle=mahorg!85!black,
            borderline west = {1mm}{0pt}{mahorg!85!black},
            segmentation style={solid, mahorg!85!black}
}

\newtcolorbox[auto counter,number within=section,number format=\arabic]{claim}[1][]{
            colback=mahtqs!10!white,enhanced,
            title={\textbf{\faExclamation \ \ Khẳng định --- \ }},
            boxrule=0pt,
	    frame hidden,
            breakable,fonttitle=\sffamily,
            arc=0mm,
            sharp corners,
            detach title,
            before upper = \tcbtitle,
            colframe=mahtqs,coltitle=mahtqs!85!black,
            borderline west = {1mm}{0pt}{mahtqs!85!black},
            segmentation style={solid, mahtqs!85!black}
}

\newtcolorbox[auto counter,number within=section,number format=\arabic]{takeaway}[1][]{
            colback=mahnvy!10!white,enhanced,
            title={\textbf{\faExclamation \ \ Nhận xét --- \ }},
            boxrule=0pt,
	    frame hidden,
            breakable,fonttitle=\sffamily,
            arc=0mm,
            sharp corners,
            detach title,
            before upper = \tcbtitle,
            colframe=mahnvy,coltitle=mahnvy!85!black,
            borderline west = {1mm}{0pt}{mahnvy!85!black},
            segmentation style={solid, mahnvy!85!black}
}

\newenvironment{solution}[1][Lời giải]{%
  \proof[\faPenNib \hspace{0.2cm} \ttfamily \scshape \large #1]%
}{\(\hfill \blacksquare\){\parfillskip0pt\par}}


% -= Header + Title =-

% Header

\fancyhead[RO]{\footnotesize \thepage}
\fancyhead[RE]{\footnotesize \textbf{LỐI VÀO HÌNH HỌC PHẲNG}}
\fancyhead[LE]{\footnotesize \thepage}
\fancyhead[LO]{\footnotesize \leftmark}
\fancyfoot{}

\renewcommand{\footrulewidth}{0pt}

% \fancyhead[L]{\hspace{-1.75cm} \textbf{LỐI VÀO HÌNH HỌC PHẲNG}} % tiêu đề bài viết
% \fancyhead[R]{%
%     \makebox[-160pt][c]{
%         \fboxsep=1.51pt
%         \colorbox{headerbg}{\parbox[b][15pt][b]{\dimexpr\textwidth-3in\relax}{
%             \hspace{0.56cm}
%             {\textbf{\textcolor{headertext}{Mark Nguyen}}}
%             \vspace{0.075cm}
%         }}
%     }
% }


% Title

\makeatletter
\titleformat{\section}
  {\normalfont\Large\bfseries\sffamily}{\color{purple}\S\thesection}{1em}{}
\titleformat{\subsection}
  {\normalfont\large\bfseries\sffamily}{\color{purple}\S\thesubsection}{1em}{}
\titleformat{\subsubsection}
  {\normalfont\normalsize\bfseries\ttfamily}{\color{purple}\S\thesubsubsection}{1em}{}
\makeatother
  

\renewcommand{\cfttoctitlefont}{\hfill\bfseries\Large}
\renewcommand{\cftaftertoctitle}{\hfill\hspace{-1cm}}